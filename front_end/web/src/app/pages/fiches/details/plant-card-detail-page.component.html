<div class="page">
  <header class="hero">
    <div class="hero-inner">
      <div class="hero-top">
        <button class="back-fab" mat-stroked-button type="button" (click)="goBack()">
          <mat-icon>arrow_back</mat-icon>
          <span class="back-txt">Retour</span>
        </button>

        <div class="kicker">
          <mat-icon>psychiatry</mat-icon>
          Fiche plante
        </div>
      </div>

      <div class="hero-main" *ngIf="item as p; else heroLoading">
        <div class="hero-media">
          <ng-container *ngIf="coverSrc(p.imageUrl) as src; else noCover">
            <img class="cover-img" [src]="src" alt="Photo de {{ p.commonName }}" />
          </ng-container>
          <ng-template #noCover>
            <div class="no-cover">
              <mat-icon>psychiatry</mat-icon>
              <div>Sans image</div>
            </div>
          </ng-template>

          <div class="badge">{{ labelWaterType(p.waterType) }}</div>
        </div>

        <div class="hero-text">
          <h1>{{ p.commonName }}</h1>
          <p class="sub" *ngIf="p.scientificName"><em>{{ p.scientificName }}</em></p>

          <div class="quick">
            <span class="pill" *ngIf="p.light">
              <mat-icon>wb_sunny</mat-icon> {{ p.light }}
            </span>

            <span class="pill" *ngIf="p.co2">
              <mat-icon>air</mat-icon> CO₂ {{ p.co2 }}
            </span>

            <span class="pill" *ngIf="formatRange(p.tempMin, p.tempMax, '°C') as t">
              <mat-icon>device_thermostat</mat-icon> {{ t }}
            </span>

            <span class="pill" *ngIf="formatRange(p.phMin, p.phMax, '') as ph">
              <mat-icon>science</mat-icon> pH {{ ph }}
            </span>

            <span class="pill" *ngIf="p.difficulty">
              <mat-icon>signal_cellular_alt</mat-icon> {{ p.difficulty }}
            </span>
          </div>
        </div>
      </div>

      <ng-template #heroLoading>
        <div class="hero-skeleton" *ngIf="loading">
          <mat-progress-spinner mode="indeterminate" diameter="22"></mat-progress-spinner>
          <span>Chargement…</span>
        </div>
      </ng-template>
    </div>
  </header>

  <section class="empty" *ngIf="!loading && notFound">
    <div class="empty-box">
      <mat-icon class="empty-icon">error_outline</mat-icon>
      <div class="empty-title">Fiche introuvable</div>
      <div class="empty-sub">Soit elle n’existe pas, soit elle n’est pas publiée.</div>
      <a mat-flat-button color="primary" routerLink="/species">Revenir aux fiches</a>
    </div>
  </section>

  <ng-container *ngIf="!loading && item as p">
    <section class="content">
      <div class="section">
        <h2>
          <mat-icon>tune</mat-icon>
          Besoins & paramètres
        </h2>

        <div class="grid">
          <div class="kv">
            <div class="k">Lumière</div>
            <div class="v">{{ p.light || '—' }}</div>
          </div>
          <div class="kv">
            <div class="k">CO₂</div>
            <div class="v">{{ p.co2 || '—' }}</div>
          </div>
          <div class="kv">
            <div class="k">Croissance</div>
            <div class="v">{{ p.growthRate || '—' }}</div>
          </div>
          <div class="kv">
            <div class="k">Hauteur max</div>
            <div class="v">{{ p.maxHeightCm ? (p.maxHeightCm + ' cm') : '—' }}</div>
          </div>

          <div class="kv">
            <div class="k">Température</div>
            <div class="v">{{ formatRange(p.tempMin, p.tempMax, '°C') || '—' }}</div>
          </div>
          <div class="kv">
            <div class="k">pH</div>
            <div class="v">{{ formatRange(p.phMin, p.phMax, '') || '—' }}</div>
          </div>
          <div class="kv">
            <div class="k">GH</div>
            <div class="v">{{ formatRange(p.ghMin, p.ghMax, '') || '—' }}</div>
          </div>
          <div class="kv">
            <div class="k">KH</div>
            <div class="v">{{ formatRange(p.khMin, p.khMax, '') || '—' }}</div>
          </div>
        </div>

        <mat-divider></mat-divider>

        <div class="grid two">
          <div class="kv">
            <div class="k">Catégorie</div>
            <div class="v">{{ p.category || '—' }}</div>
          </div>
          <div class="kv">
            <div class="k">Placement</div>
            <div class="v">{{ p.placement || '—' }}</div>
          </div>

          <div class="kv">
            <div class="k">Multiplication</div>
            <div class="v">{{ p.propagation || '—' }}</div>
          </div>
          <div class="kv">
            <div class="k">Substrat requis</div>
            <div class="v">{{ yesNo(p.substrateRequired) }}</div>
          </div>

          <div class="kv">
            <div class="k">Besoins Fer</div>
            <div class="v">{{ yesNo(p.needsFe) }}</div>
          </div>
          <div class="kv">
            <div class="k">Besoins NO3</div>
            <div class="v">{{ yesNo(p.needsNo3) }}</div>
          </div>

          <div class="kv">
            <div class="k">Besoins PO4</div>
            <div class="v">{{ yesNo(p.needsPo4) }}</div>
          </div>
          <div class="kv">
            <div class="k">Besoins K</div>
            <div class="v">{{ yesNo(p.needsK) }}</div>
          </div>
        </div>

        <mat-divider></mat-divider>

        <div class="grid two">
          <div class="kv">
            <div class="k">Famille</div>
            <div class="v">{{ p.family || '—' }}</div>
          </div>
          <div class="kv">
            <div class="k">Origine</div>
            <div class="v">{{ p.origin || '—' }}</div>
          </div>

          <div class="kv">
            <div class="k">Compatibilité</div>
            <div class="v">{{ p.compatibility || '—' }}</div>
          </div>
          <div class="kv">
            <div class="k">Taille / entretien</div>
            <div class="v">{{ p.trimming || '—' }}</div>
          </div>
        </div>
      </div>

      <div class="section" *ngIf="p.notes">
        <h2>
          <mat-icon>description</mat-icon>
          Notes
        </h2>
        <div class="blocks">
          <div class="block">
            <div class="bd">{{ p.notes }}</div>
          </div>
        </div>
      </div>

      <div class="note">
        <mat-icon>info</mat-icon>
        Les besoins varient selon la lumière, le CO₂, le sol et la stabilité du bac.
      </div>
    </section>
  </ng-container>
</div>
