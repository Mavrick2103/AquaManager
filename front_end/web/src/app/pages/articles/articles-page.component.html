<div class="page">
  <!-- HERO -->
  <header class="hero">
  <div class="hero-inner">
    <!-- Top bar -->
    <div class="hero-top">
      <button class="back-fab" mat-stroked-button type="button" (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
        <span class="back-txt">Retour</span>
      </button>

      <div class="kicker">
        <mat-icon>tips_and_updates</mat-icon>
        Conseils AquaManager
      </div>
    </div>

    <!-- Content -->
    <div class="hero-main">
      <img
        class="app-logo"
        src="./Logo_AquaManger.png"
        alt="AquaManager"
        loading="lazy"
        decoding="async"
      />

      <div class="hero-text">
        <h1>Articles</h1>
        <p class="lead">
          Maintenance, fertilisation, algues, cyclage… du concret, clair, actionnable.
        </p>
      </div>
    </div>

    <!-- (si tu gardes les bulles un jour, tu les mets dans hero-right) -->
  </div>
</header>


  <!-- CONTROLS (sticky) -->
  <section class="controls" role="search" aria-label="Recherche d'articles">
    <div class="controls-inner">
      <mat-form-field appearance="outline" class="search">
        <mat-label>Rechercher</mat-label>
        <input
          matInput
          [formControl]="qCtrl"
          placeholder="ex: fertilisation, algues, cyclage..."
        />
        <button
          *ngIf="qCtrl.value"
          matSuffix
          mat-icon-button
          (click)="qCtrl.setValue('')"
          aria-label="Effacer"
        >
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>

      <mat-form-field appearance="outline" class="theme">
        <mat-label>Thème</mat-label>
        <mat-select [formControl]="themeCtrl">
          <mat-option [value]="null">Tous</mat-option>
          <mat-option *ngFor="let t of themes" [value]="t.slug">{{ t.name }}</mat-option>

        </mat-select>
      </mat-form-field>

      <div class="actions">
        <button mat-flat-button color="primary" type="button" (click)="refresh()" [disabled]="loading">
          <mat-icon>refresh</mat-icon>
          Actualiser
        </button>

        <button mat-stroked-button type="button" (click)="clear()" [disabled]="loading">
          <mat-icon>restart_alt</mat-icon>
          Reset
        </button>
      </div>
    </div>

    <!-- petite ligne de "résultat" -->
    <div class="hint" *ngIf="!loading">
      <span class="count">
        <mat-icon>article</mat-icon>
        {{ items.length }} article{{ items.length > 1 ? 's' : '' }}
      </span>
      <span class="sep">•</span>
      <span class="muted">Clique sur une carte pour lire.</span>
    </div>
  </section>

  <!-- STATES -->
  <section class="state" *ngIf="loading">
    <mat-progress-spinner mode="indeterminate" diameter="22"></mat-progress-spinner>
    <span>Chargement…</span>
  </section>

  <section class="empty" *ngIf="!loading && (!items || items.length === 0)">
    <div class="empty-box">
      <mat-icon class="empty-icon">search_off</mat-icon>
      <div class="empty-title">Aucun article trouvé</div>
      <div class="empty-sub">Essaye un autre mot-clé ou change le thème.</div>
      <button mat-flat-button color="primary" type="button" (click)="clear()">
        Réinitialiser
      </button>
    </div>
  </section>

  <!-- GRID -->
  <section class="grid" *ngIf="!loading && items?.length">
    <article class="card" *ngFor="let a of items; trackBy: trackById">
      <a class="card-link" [routerLink]="['/articles', a.slug]" aria-label="Lire l'article">
        <div class="cover" [class.no]="!a.coverImageUrl">
          <ng-container *ngIf="coverSrc(a.coverImageUrl) as src; else noCover">
            <img [src]="src" loading="lazy" decoding="async" />
          </ng-container>
          <ng-template #noCover>
            <div class="no-cover">
              <mat-icon>water</mat-icon>
              <span>AquaManager</span>
            </div>
          </ng-template>

          <!-- badge theme -->
          <div class="badge">
            {{ a.theme?.name || 'Conseils' }}
          </div>
        </div>

        <div class="body">
          <h2 class="title">{{ a.title }}</h2>

          <p class="excerpt" *ngIf="a.excerpt; else fallback">
            {{ a.excerpt }}
          </p>
          <ng-template #fallback>
            <p class="excerpt muted">Clique pour lire l’article.</p>
          </ng-template>

          <div class="meta">
            <span class="date">
              <mat-icon>calendar_month</mat-icon>
              {{ (a.publishedAt || a.createdAt) | date:'mediumDate' }}
            </span>

            <span class="cta">
              Lire
              <mat-icon>arrow_forward</mat-icon>
            </span>
          </div>
        </div>
      </a>
    </article>
  </section>
</div>
