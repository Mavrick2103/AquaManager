<!-- Toolbar : logo | titre | actions -->
<section class="toolbar">
  <a class="brand" [routerLink]="['/aquariums']" aria-label="Retour à la liste">
    <img src="/Logo_AquaManger.png" alt="AquaManager" class="logo" />
  </a>

  <h1>Fiche aquarium</h1>

  <div class="actions">
    <button mat-stroked-button color="warn" type="button"
            (click)="remove()" [disabled]="saving">
      <mat-icon>delete</mat-icon>
      <span>Supprimer</span>
    </button>
    <button mat-raised-button type="button" class="btn-primary"
            (click)="save()" [disabled]="saving || form.invalid">
      <mat-icon>save</mat-icon>
      <span>Enregistrer</span>
    </button>
  </div>
</section>

<!-- Bandeau résumé -->
<section class="hero" *ngIf="!loading">
  <div class="left">
    <div class="avatar">
      <mat-icon>water_drop</mat-icon>
    </div>
    <div class="headings">
      <div class="title">{{ form.value.name || '—' }}</div>
      <div class="meta">
        ~ {{ liters }} L
        <span class="dot"></span>
        <mat-chip-set>
          <mat-chip [ngClass]="form.value.waterType === 'EAU_DE_MER' ? 'mer' : 'douce'">
            {{ form.value.waterType === 'EAU_DE_MER' ? 'Eau de mer' : 'Eau douce' }}
          </mat-chip>
        </mat-chip-set>
      </div>
    </div>
  </div>

  <div class="right">
    <div class="kpi">
      <div class="kpi-label">Dimensions</div>
      <div class="kpi-value">
        {{ form.value.lengthCm || 0 }} × {{ form.value.widthCm || 0 }} × {{ form.value.heightCm || 0 }} cm
      </div>
    </div>
    <div class="kpi">
      <div class="kpi-label">Mise en eau</div>
      <div class="kpi-value">{{ form.value.startDate || '—' }}</div>
    </div>
  </div>
</section>

<!-- Carte formulaire -->
<ng-container *ngIf="!loading; else loader">
  <mat-card class="sheet">
    <mat-card-content>
      <form [formGroup]="form" class="grid">
        <mat-form-field appearance="outline">
          <mat-label>Nom</mat-label>
          <input matInput formControlName="name" />
          <mat-hint align="end">{{ form.get('name')?.value?.length || 0 }}/255</mat-hint>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Type d’eau</mat-label>
          <mat-select formControlName="waterType">
            <mat-option value="EAU_DOUCE">Eau douce</mat-option>
            <mat-option value="EAU_DE_MER">Eau de mer</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Longueur (cm)</mat-label>
          <input matInput type="number" formControlName="lengthCm" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Largeur (cm)</mat-label>
          <input matInput type="number" formControlName="widthCm" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Hauteur (cm)</mat-label>
          <input matInput type="number" formControlName="heightCm" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Date de mise en eau</mat-label>
          <input matInput type="date" formControlName="startDate" />
        </mat-form-field>
      </form>
    </mat-card-content>
  </mat-card>
</ng-container>
<button mat-fab color="primary" class="add-measure-fab" (click)="openMeasurementDialog()">
  <mat-icon>add</mat-icon>
</button>

<app-water-measurements-chart
  [aquariumId]="id"
  [waterType]="waterType">
</app-water-measurements-chart>




<!-- Loader -->
<ng-template #loader>
  <div class="loading">
    <mat-progress-spinner diameter="56"></mat-progress-spinner>
  </div>
</ng-template>
