<!-- Toolbar / actions -->
<section class="toolbar">
  <a class="brand" [routerLink]="['/aquariums']" aria-label="Retour à la liste">
    <img src="/Logo_AquaManger.png" alt="AquaManager" class="logo" />
  </a>

  <h1>Fiche aquarium</h1>

  <div class="actions">
    <!-- Ouvre la fenêtre avec les champs (Nom, Type d’eau, L/L/H, Date) -->
    <button mat-flat-button color="primary" type="button" (click)="openEditDialog()" [disabled]="saving">
      <mat-icon>edit</mat-icon>
      <span>Modifier l’aquarium</span>
    </button>

    <button mat-stroked-button color="warn" type="button"
            (click)="remove()" [disabled]="saving">
      <mat-icon>delete</mat-icon>
      <span>Supprimer</span>
    </button>
    <button mat-raised-button type="button" class="btn-primary"
            (click)="save()" [disabled]="saving || form.invalid">
      <mat-icon>save</mat-icon>
      <span>Enregistrer</span>
    </button>
  </div>
</section>

<!-- Bandeau résumé (inchangé) -->
<section class="hero" *ngIf="!loading">
  <div class="left">
    <div class="avatar">
      <mat-icon>water_drop</mat-icon>
    </div>
    <div class="headings">
      <div class="title">{{ form.value.name || '—' }}</div>
      <div class="meta">
        {{ liters }} L
        <span class="dot"></span>
        <mat-chip-set>
          <mat-chip [ngClass]="form.value.waterType === 'EAU_DE_MER' ? 'mer' : 'douce'">
            {{ form.value.waterType === 'EAU_DE_MER' ? 'Eau de mer' : 'Eau douce' }}
          </mat-chip>
        </mat-chip-set>
      </div>
    </div>
  </div>

  <div class="right">
    <div class="kpi">
      <div class="kpi-label">Dimensions</div>
      <div class="kpi-value">
        {{ form.value.lengthCm || 0 }} × {{ form.value.widthCm || 0 }} × {{ form.value.heightCm || 0 }} cm
      </div>
    </div>
    <div class="kpi">
      <div class="kpi-label">Mise en eau</div>
      <div class="kpi-value">{{ form.value.startDate || '—' }}</div>
    </div>
  </div>
</section>

<!-- ========= Onglets en bas de page ========= -->
<mat-tab-group dynamicHeight>
  <!-- Onglet MESURES -->
  <mat-tab label="Mesures">
    <div class="tab-section">
      <div class="tab-actions">
        <button mat-raised-button color="primary" (click)="openMeasurementDialog()">
          <mat-icon>add</mat-icon>
          Ajouter une mesure
        </button>
      </div>

      <app-water-measurements-chart
        [aquariumId]="id"
        [waterType]="waterType">
      </app-water-measurements-chart>
    </div>
  </mat-tab>

  <!-- Onglet ESPÈCES -->
  <mat-tab label="Espèces">
    <div class="tab-section">
      <div class="tab-actions">
        <button mat-raised-button (click)="addSpecies()">
          <mat-icon>add</mat-icon>
          Ajouter une espèce
        </button>
      </div>

      <mat-list *ngIf="species.length; else emptySpecies">
        <mat-list-item *ngFor="let s of species; let i = index">
          <div matListItemTitle>{{ s.name }}</div>
          <div matListItemLine>Quantité : {{ s.count }}</div>
          <button mat-icon-button color="warn" (click)="removeSpecies(i)" aria-label="Supprimer">
            <mat-icon>delete</mat-icon>
          </button>
        </mat-list-item>
      </mat-list>

      <ng-template #emptySpecies>
        <p style="opacity:.7; margin:16px 0">Aucune espèce enregistrée pour le moment.</p>
      </ng-template>
    </div>
  </mat-tab>
</mat-tab-group>

<!-- (plus de formulaire ici : il est dans le dialog) -->

<!-- Loader -->
<ng-template #loader>
  <div class="loading">
    <mat-progress-spinner diameter="56"></mat-progress-spinner>
  </div>
</ng-template>
