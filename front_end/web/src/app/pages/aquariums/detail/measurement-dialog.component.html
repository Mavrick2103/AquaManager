<h2 mat-dialog-title class="dialog-title">
  <mat-icon>science</mat-icon>
  <div class="titles">
    <span>Nouvelle mesure d’eau</span>
    <small *ngIf="data?.name">Aquarium : {{ data.name }}</small>
  </div>
</h2>

<div mat-dialog-content class="dialog-content">
  <form [formGroup]="form" class="form-grid">
    <!-- Ligne 1 : Date / pH / Temp -->
    <div class="top-row">
      <mat-form-field appearance="outline">
        <mat-label>Date de mesure</mat-label>
        <input matInput [matDatepicker]="picker" formControlName="measuredAt">
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>pH</mat-label>
        <input matInput type="number" step="0.1" formControlName="ph">
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Température (°C)</mat-label>
        <input matInput type="number" step="1" formControlName="temp">
      </mat-form-field>
    </div>

    <!-- Eau douce -->
    <div *ngIf="data.type === 'EAU_DOUCE'" class="section">
      <div class="section-header">
        <span class="pill pill-fresh">Eau douce</span>
        <span class="section-label">Paramètres généraux</span>
      </div>

      <div class="params-grid">
        <mat-form-field appearance="outline">
          <mat-label>KH (°d)</mat-label>
          <input matInput type="number" step="1" formControlName="kh">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>GH (°d)</mat-label>
          <input matInput type="number" step="1" formControlName="gh">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>NO₂ (mg/L)</mat-label>
          <input matInput type="number" step="0.01" formControlName="no2">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>NO₃ (mg/L)</mat-label>
          <input matInput type="number" step="1" formControlName="no3">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Fer (Fe) mg/L</mat-label>
          <input matInput type="number" step="0.05" formControlName="fe">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Potassium (K) mg/L</mat-label>
          <input matInput type="number" step="1" formControlName="k">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Silicates (SiO₂) mg/L</mat-label>
          <input matInput type="number" step="0.1" formControlName="sio2">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>PO₄ (mg/L)</mat-label>
          <input matInput type="number" step="0.01" formControlName="po4">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Ammoniaque (NH₃) mg/L</mat-label>
          <input matInput type="number" step="0.01" formControlName="nh3">
        </mat-form-field>
      </div>
    </div>

    <!-- Eau de mer -->
    <div *ngIf="data.type === 'EAU_DE_MER'" class="section">
      <div class="section-header">
        <span class="pill pill-marine">Eau de mer</span>
        <span class="section-label">Paramètres généraux</span>
      </div>

      <div class="params-grid">
        <mat-form-field appearance="outline">
          <mat-label>Alcalinité (dKH)</mat-label>
          <input matInput type="number" step="0.1" formControlName="dkh">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Salinité (ppt)</mat-label>
          <input matInput type="number" step="0.1" formControlName="salinity">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Calcium (mg/L)</mat-label>
          <input matInput type="number" step="1" formControlName="ca">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Magnésium (mg/L)</mat-label>
          <input matInput type="number" step="1" formControlName="mg">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>NO₃ (mg/L)</mat-label>
          <input matInput type="number" step="1" formControlName="no3">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>PO₄ (mg/L)</mat-label>
          <input matInput type="number" step="0.01" formControlName="po4">
        </mat-form-field>
      </div>
    </div>

    <!-- Commentaire -->
    <mat-form-field appearance="outline" class="full">
      <mat-label>Commentaire (optionnel)</mat-label>
      <textarea matInput rows="2" formControlName="comment" maxlength="120"></textarea>
      <mat-hint align="end">{{ form.value.comment?.length || 0 }} / 120</mat-hint>
    </mat-form-field>
  </form>
</div>

<div mat-dialog-actions align="end" class="dialog-actions">
  <button mat-stroked-button (click)="close()" [disabled]="loading">
    <mat-icon>close</mat-icon> Annuler
  </button>
  <button mat-flat-button color="primary" (click)="save()" [disabled]="loading || form.invalid">
    <ng-container *ngIf="!loading; else loadingTpl">
      <mat-icon>save</mat-icon>
      Enregistrer
    </ng-container>
    <ng-template #loadingTpl>
      <mat-progress-spinner mode="indeterminate" diameter="18"></mat-progress-spinner>
    </ng-template>
  </button>
</div>
