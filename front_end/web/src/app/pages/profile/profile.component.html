<a class="brand" routerLink="/" aria-label="Retour à l’accueil">
  <img
    src="/Logo_AquaManger.png"
    alt="AquaManager"
    class="logo"
    width="280"
    height="70"
    loading="lazy"
    decoding="async"
  />
</a>

<mat-card class="settings-card" role="main">
  <header class="settings-header" aria-labelledby="page-title">
    <div class="titles">
      <h1 id="page-title">Paramètres & Profil</h1>
      <p class="subtitle">Personnalisez votre expérience et gérez vos informations.</p>
    </div>

    <div class="quick-actions">
      <span class="role-pill" *ngIf="isAdmin">Admin</span>
      <span class="role-pill -editor" *ngIf="!isAdmin && isEditorOnly">Éditeur</span>
      <span class="role-pill -user" *ngIf="!isAdmin && !isEditorOnly">User</span>

      <button mat-stroked-button color="warn" (click)="logout()" aria-label="Se déconnecter">
        <mat-icon>logout</mat-icon>
        Déconnexion
      </button>
    </div>
  </header>

  <mat-divider class="header-divider"></mat-divider>

  <mat-tab-group class="tabs-compact" animationDuration="150ms">
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>person</mat-icon><span>Profil</span>
      </ng-template>

      <section class="tab-pane">
        <form [formGroup]="form" class="profile-grid" aria-describedby="profil-help">
          <p id="profil-help" class="visually-hidden">
            Modifiez vos informations puis cliquez sur Enregistrer.
          </p>

          <div class="row">
            <label class="label" for="fullName">
              <mat-icon>badge</mat-icon> Nom complet
            </label>
            <mat-form-field appearance="fill" class="field">
              <input id="fullName" matInput formControlName="fullName" maxlength="80" autocomplete="name" />
              <mat-hint align="end">{{ fullNameCtrl.value?.length || 0 }} / 80</mat-hint>
            </mat-form-field>
          </div>

          <div class="row">
            <label class="label" for="email">
              <mat-icon>mail</mat-icon> Email
            </label>
            <mat-form-field appearance="fill" class="field">
              <input id="email" matInput type="email" formControlName="email" maxlength="160" autocomplete="email" />
              <mat-error *ngIf="emailCtrl.invalid && emailCtrl.touched">Email invalide</mat-error>
            </mat-form-field>
          </div>

          <div class="row multi">
            <div class="label">
              <mat-icon>password</mat-icon> Mot de passe
            </div>
            <div class="field grid-2">
              <mat-form-field appearance="fill">
                <mat-label>Mot de passe actuel (si requis)</mat-label>
                <input matInput type="password" formControlName="currentPassword" autocomplete="current-password" />
              </mat-form-field>

              <mat-form-field appearance="fill">
                <mat-label>Nouveau mot de passe</mat-label>
                <input matInput type="password" formControlName="newPassword" autocomplete="new-password" />
                <mat-hint>6 caractères minimum</mat-hint>
              </mat-form-field>
            </div>
          </div>

          <div class="actions">
            <button mat-button type="button" (click)="reset()" [disabled]="loading">
              <mat-icon>refresh</mat-icon> Annuler
            </button>

            <button
              mat-flat-button
              color="primary"
              type="button"
              (click)="saveAll()"
              [disabled]="loading || form.invalid || !hasChanges"
            >
              <mat-icon *ngIf="!loading">save</mat-icon>
              <mat-progress-spinner *ngIf="loading" mode="indeterminate" diameter="18"></mat-progress-spinner>
              Enregistrer
            </button>
          </div>
        </form>

        <mat-card class="danger-card" aria-live="polite">
          <h2>Zone dangereuse</h2>
          <p>
            La suppression de votre compte est <strong>définitive</strong>. Toutes vos données associées seront supprimées.
          </p>
          <button mat-flat-button color="warn" (click)="deleteAccount()">
            <mat-icon>delete_forever</mat-icon>
            Supprimer mon compte
          </button>
        </mat-card>
      </section>
    </mat-tab>

    <!--<mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>tune</mat-icon><span>Préférences</span>
      </ng-template>

      <section class="tab-pane">
        ...
      </section>
    </mat-tab>

    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>database</mat-icon><span>Données</span>
      </ng-template>

      <section class="tab-pane">
        ...
      </section>
    </mat-tab> -->

    <!-- ✅ ONGLET ÉDITEUR : visible si EDITOR ou ADMIN -->
    <mat-tab *ngIf="isEditor">
      <ng-template mat-tab-label>
        <mat-icon>edit</mat-icon><span>Éditeur</span>
      </ng-template>

      <section class="tab-pane">
        <div class="editor-grid">
          <mat-card class="editor-card">
            <div class="editor-head">
              <mat-icon>tips_and_updates</mat-icon>
              <h3>Articles / Conseils</h3>
            </div>
            <p>Créer / modifier des articles et gérer leurs thèmes.</p>
            <div class="editor-actions">
              <button mat-stroked-button color="primary" routerLink="/admin/articles">
                <mat-icon>open_in_new</mat-icon>
                Accéder
              </button>
            </div>
          </mat-card>

          <mat-card class="editor-card">
            <div class="editor-head">
              <mat-icon>pets</mat-icon>
              <h3>Fiches poissons</h3>
            </div>
            <p>Créer / modifier les fiches poissons (paramètres, compatibilités, biotope…).</p>
            <div class="editor-actions">
              <button mat-stroked-button color="primary" routerLink="/admin/species/fish">
                <mat-icon>open_in_new</mat-icon>
                Accéder
              </button>
            </div>
          </mat-card>

          <mat-card class="editor-card">
            <div class="editor-head">
              <mat-icon>local_florist</mat-icon>
              <h3>Fiches plantes</h3>
            </div>
            <p>Créer / modifier les fiches plantes (lumière, CO₂, sol, croissance…).</p>
            <div class="editor-actions">
              <button mat-stroked-button color="primary" routerLink="/admin/species/plant">
                <mat-icon>open_in_new</mat-icon>
                Accéder
              </button>
            </div>
          </mat-card>
        </div>
      </section>
    </mat-tab>

    <mat-tab *ngIf="isAdmin">
      <ng-template mat-tab-label>
        <mat-icon>admin_panel_settings</mat-icon><span>Admin</span>
      </ng-template>

      <section class="tab-pane">
        <div class="admin-grid">

          <mat-card class="admin-card">
            <div class="admin-head">
              <mat-icon>show_chart</mat-icon>
              <h3>Dashboard Admin</h3>
            </div>
            <p>Suivre l'évolution du site</p>
            <div class="admin-actions">
              <button mat-stroked-button color="primary" [routerLink]="'/admin/metrics'">
                <mat-icon>manage_accounts</mat-icon>
                Suivie
              </button>
            </div>
          </mat-card>

          <mat-card class="admin-card">
            <div class="admin-head">
              <mat-icon>group</mat-icon>
              <h3>Utilisateurs</h3>
            </div>
            <p>Gestion des utilisateur, crée, modifier et supprimer</p>
            <div class="admin-actions">
              <button mat-stroked-button color="primary" [routerLink]="'/admin/users'">
                <mat-icon>view_list</mat-icon>
                Gérer les utilisateur
              </button>

            </div>
          </mat-card>

          <!-- Plantes -->
          <mat-card class="admin-card">
            <div class="admin-head">
              <mat-icon>local_florist</mat-icon>
              <h3>Plantes</h3>
            </div>
            <p>Créer / modifier les fiches plantes (lumière, CO₂, sol, croissance…).</p>
            <div class="admin-actions">
              <button mat-stroked-button color="primary" routerLink="/admin/species/plant">
                <mat-icon>edit</mat-icon>
                Gérer les plantes
              </button>
            </div>
          </mat-card>

          <!-- Espèces -->
          <mat-card class="admin-card">
            <div class="admin-head">
              <mat-icon>pets</mat-icon>
              <h3>Espèces</h3>
            </div>
            <p>Créer / modifier les espèces (paramètres, compatibilités, taille, biotope…)</p>
            <div class="admin-actions">
              <button mat-stroked-button color="primary" routerLink="/admin/species/fish">
                <mat-icon>library_books</mat-icon>
                Gérer les espèces
              </button>
            </div>
          </mat-card>
        </div>
      </section>
    </mat-tab>
  </mat-tab-group>
</mat-card>
