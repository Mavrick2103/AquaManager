<mat-toolbar class="topbar">
  <div class="brand">
    <img src="/Logo_AquaManger.png" alt="AquaManager" class="logo-img" />
  </div>

  <span class="spacer"></span>

  <!-- Ic√¥ne profil avec menu au survol -->
  <button
    mat-icon-button
    aria-label="Profil"
    [matMenuTriggerFor]="profileMenu"
    [matMenuTriggerRestoreFocus]="false"
    #menuTrigger="matMenuTrigger"
    (mouseenter)="openMenu(menuTrigger)"
  >
    <mat-icon>account_circle</mat-icon>
  </button>

  <mat-menu
    #profileMenu="matMenu"
    (mouseenter)="keepOpen(menuTrigger)"
    (mouseleave)="closeMenu(menuTrigger)"
    xPosition="before"
    yPosition="below"
  >
    <button mat-menu-item [routerLink]="'/profile'">
      <mat-icon>person</mat-icon>
      <span>Profil utilisateur</span>
    </button>
    <button mat-menu-item [routerLink]="'/settings'">
      <mat-icon>settings</mat-icon>
      <span>Param√®tres</span>
    </button>
  </mat-menu>

  <!-- D√©connexion -->
  <button mat-stroked-button color="warn" class="logout-btn" (click)="logout()">
    <mat-icon>logout</mat-icon>
    <span>D√©connexion</span>
  </button>
</mat-toolbar>

<main class="home-main">
  <!-- Hero -->
  <section class="hero">
    <h1>G√©rez vos aquariums en toute clart√©</h1>
    <p class="subtitle">
      Suivi des param√®tres, entretiens planifi√©s, historique ‚Äî tout au m√™me endroit.
    </p>
    <div class="cta-row">
      <button mat-raised-button routerLink="/aquariums">Mes aquariums</button>
      <button mat-raised-button routerLink="/calendar">Calendrier</button>
    </div>
  </section>

  <!-- KPI -->
  <section class="grid">
    <!-- T√¢ches aujourd‚Äôhui -->
    <div class="card kpi -today" routerLink="/calendar">
      <div class="kpi-value">{{ todayTasksCount }}</div>
      <div class="kpi-label">T√¢ches aujourd‚Äôhui</div>
    </div>

    <!-- ‚úÖ Nouvelles mesures d‚Äôeau r√©alis√©es ce mois-ci (tous bacs) -->
    <div class="card kpi">
      <div class="kpi-value">{{ monthlyMeasurementsCount}}</div>
      <div class="kpi-label">Mesures d‚Äôeau ce mois-ci</div>
    </div>

    <!-- ‚úÖ Nombre de t√¢ches planifi√©es dans les 7 prochains jours -->
    <div class="card kpi">
      <div class="kpi-value">{{ upcomingTasks.length }}</div>
      <div class="kpi-label">T√¢ches √† venir (7j)</div>
    </div>
  </section>

  <!-- ====== Deux colonnes : Derni√®res activit√©s & Activit√©s √† venir ====== -->
  <section class="activity-grid">
    <!-- ‚úÖ Derni√®res activit√©s (max 5, inclut mesures d'eau r√©alis√©es) -->
    <section class="card activity">
      <h2>Derni√®res activit√©s</h2>
      <ul class="activity-list">
        <li *ngFor="let t of latestActivities">
          <mat-icon>{{ typeIcon(t.type) }}</mat-icon>
          <span class="txt">
            <strong>{{ t.title || typeLabel(t.type) }}</strong>
            <ng-container *ngIf="t.aquarium?.name"> ‚Äî {{ t.aquarium?.name }}</ng-container>
          </span>
          <span class="time">{{ whenLabel(t) }}</span>
        </li>
        <li *ngIf="!latestActivities.length">
          <mat-icon>info</mat-icon>
          Aucune activit√© r√©cente
        </li>
      </ul>
    </section>

    <!-- ‚úÖ Activit√©s √† venir (7 jours, max 5) -->
    <section class="card activity">
      <h2>Activit√©s √† venir</h2>
      <ul class="activity-list">
        <li *ngFor="let t of upcomingTasks">
          <mat-icon>{{ typeIcon(t.type) }}</mat-icon>
          <span class="txt">
            <strong>{{ t.title }}</strong>
            <ng-container *ngIf="t.aquarium?.name"> ‚Äî {{ t.aquarium?.name }}</ng-container>
          </span>
          <span class="time">{{ whenLabel(t) }}</span>
        </li>

        <li *ngIf="!upcomingTasks.length">
          <mat-icon>check_circle</mat-icon>
          Aucune activit√© pr√©vue dans les 7 jours
        </li>
      </ul>
    </section>
  </section>

  <!-- Calendrier hebdo encadr√© -->
  <section class="calendar-wrap">
    <app-week-calendar></app-week-calendar>
  </section>
</main>

<!-- ===== Footer ===== -->
<footer class="footer">
  <div class="footer-content">
    <div class="footer-brand">
      <img src="/Logo_AquaManger.png" alt="AquaManager" class="footer-logo" />
      <p class="footer-desc">
        AquaManager ‚Äì Suivez, entretenez et sublimez vos aquariums en toute simplicit√© üåøüê†
      </p>
    </div>

    <div class="footer-links">
      <h3>Navigation</h3>
      <ul>
        <li><a routerLink="/home">Accueil</a></li>
        <li><a routerLink="/aquariums">Mes aquariums</a></li>
        <li><a routerLink="/calendar">Calendrier</a></li>
        <li><a routerLink="/profile">Profil</a></li>
      </ul>
    </div>

    <div class="footer-social">
      <h3>Suivez-nous</h3>
      <div class="social-icons">
        <a href="#" aria-label="Facebook"><mat-icon>facebook</mat-icon></a>
        <a href="#" aria-label="Instagram"><mat-icon>photo_camera</mat-icon></a>
        <a href="#" aria-label="Twitter"><mat-icon>alternate_email</mat-icon></a>
      </div>
    </div>
  </div>

  <mat-divider></mat-divider>

  <div class="footer-bottom">
    <p>¬© {{ today.getFullYear() }} AquaManager ‚Äî Tous droits r√©serv√©s</p>
    <a href="#" class="footer-policy">Mentions l√©gales</a>
  </div>
</footer>
