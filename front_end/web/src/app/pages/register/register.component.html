<div class="register-wrap">
  <div class="hero">
    <!-- Colonne gauche : logo -->
    <div class="side">
      <img src="/Logo_AquaManger.png" alt="AquaManager" class="side-logo" />
    </div>

    <!-- Colonne droite : carte création de compte -->
    <mat-card class="register-card" role="form" aria-labelledby="regTitle">
      <h2 id="regTitle">Créer un compte</h2>
      <p class="subtitle">Rejoignez AquaManager et simplifiez le suivi de vos aquariums.</p>

      <form [formGroup]="form" (ngSubmit)="submit()" novalidate>
        <!-- Nom complet -->
        <mat-form-field appearance="outline" class="field">
          <mat-label>Nom complet</mat-label>
          <input matInput type="text" formControlName="fullName" autocomplete="name" />
          <mat-icon matSuffix>person</mat-icon>
          <mat-error *ngIf="fullName.hasError('required') && (fullName.dirty || fullName.touched)">Nom requis</mat-error>
          <mat-error *ngIf="fullName.hasError('minlength') && (fullName.dirty || fullName.touched)">Au moins 2 caractères</mat-error>
        </mat-form-field>

        <!-- Email -->
        <mat-form-field appearance="outline" class="field">
          <mat-label>Adresse e-mail</mat-label>
          <input matInput type="email" formControlName="email" autocomplete="email" />
          <mat-icon matSuffix>alternate_email</mat-icon>
          <mat-error *ngIf="email.hasError('required') && (email.dirty || email.touched)">Email requis</mat-error>
          <mat-error *ngIf="email.hasError('email') && (email.dirty || email.touched)">Email invalide</mat-error>
        </mat-form-field>

        <!-- Mots de passe -->
        <div formGroupName="passwords">
          <mat-form-field appearance="outline" class="field">
            <mat-label>Mot de passe</mat-label>
            <input matInput [type]="hidePwd() ? 'password' : 'text'" formControlName="password" autocomplete="new-password" />
            <button type="button" mat-icon-button matSuffix (click)="hidePwd.set(!hidePwd())"
                    [attr.aria-label]="hidePwd() ? 'Afficher le mot de passe' : 'Masquer le mot de passe'">
              <mat-icon>{{ hidePwd() ? 'visibility' : 'visibility_off' }}</mat-icon>
            </button>
            <mat-hint>8+ caractères, 1 maj, 1 min, 1 chiffre</mat-hint>
            <mat-error *ngIf="password?.hasError('required') && (password?.dirty || password?.touched)">Mot de passe requis</mat-error>
            <mat-error *ngIf="password?.hasError('minlength')">Minimum 8 caractères</mat-error>
            <mat-error *ngIf="password?.hasError('pattern')">Doit contenir majuscule, minuscule et chiffre</mat-error>
          </mat-form-field>

          <!-- Barre de robustesse -->
          <div class="strength">
            <div class="bar"
                 [class.lv1]="strength()>=1"
                 [class.lv2]="strength()>=2"
                 [class.lv3]="strength()>=3"
                 [class.lv4]="strength()>=4"
                 [class.lv5]="strength()>=5"></div>
            <span class="label">{{ strengthLabel() }}</span>
          </div>

          <mat-form-field appearance="outline" class="field">
            <mat-label>Confirmer le mot de passe</mat-label>
            <input matInput [type]="hideCfm() ? 'password' : 'text'" formControlName="confirmPassword" autocomplete="new-password" />
            <button type="button" mat-icon-button matSuffix (click)="hideCfm.set(!hideCfm())"
                    [attr.aria-label]="hideCfm() ? 'Afficher' : 'Masquer'">
              <mat-icon>{{ hideCfm() ? 'visibility' : 'visibility_off' }}</mat-icon>
            </button>
            <mat-error *ngIf="passwords?.hasError('passwordsMismatch') && (confirmPassword?.dirty || confirmPassword?.touched)">
              Les mots de passe ne correspondent pas
            </mat-error>
            <mat-error *ngIf="confirmPassword?.hasError('required') && (confirmPassword?.dirty || confirmPassword?.touched)">
              Confirmation requise
            </mat-error>
          </mat-form-field>
        </div>

        <!-- CGU -->
        <div class="row">
          <mat-checkbox formControlName="acceptTos">J’accepte les CGU et la politique de confidentialité</mat-checkbox>
          <a routerLink="/auth/connexion" class="link">Déjà inscrit ? Se connecter</a>
        </div>

        <!-- CTA -->
        <button class="btn-primary" mat-raised-button type="submit" [disabled]="loading() || !acceptTos.value">
          <mat-icon>person_add</mat-icon>
          <span *ngIf="!loading()">Créer mon compte</span>
          <mat-progress-spinner *ngIf="loading()" diameter="18" mode="indeterminate"></mat-progress-spinner>
        </button>

        <!-- Aide sous bouton -->
        <p class="helper">En créant un compte, vous acceptez nos CGU et notre politique de confidentialité.</p>

        <!-- Erreur globale -->
        <p class="error" *ngIf="errorMsg()">
          <mat-icon>error</mat-icon>
          {{ errorMsg() }}
        </p>
      </form>
    </mat-card>
  </div>
</div>
